"use strict";(()=>{var e={};e.id=943,e.ids=[943],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},9485:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>x,patchFetch:()=>h,requestAsyncStorage:()=>_,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>v});var r={};i.r(r),i.d(r,{GET:()=>l});var s=i(9303),a=i(8716),o=i(670),u=i(7070),n=i(8555),p=i(3377),c=i(9665);async function l(e,{params:t}){try{let i=parseInt(t.id),{searchParams:r}=new URL(e.url),s=r.get("productCode")||void 0,a=r.get("unitPrice")||void 0,o=r.get("quantity")||void 0;if(isNaN(i))return u.NextResponse.json({success:!1,error:"Ge\xe7ersiz tedarik\xe7i ID"},{status:400});let l=await (0,n.r7)(i,s);if(0===l.length){if(a&&o&&s){let e=parseFloat(a),t=parseInt(o);if(!isNaN(e)&&!isNaN(t)&&e>0){let r=new Date().toISOString().split("T")[0],a=[{id:0,invoice_number:"MEVCUT FİYAT",supplier_id:i,invoice_date:r,total_amount:e*t,created_at:r,items:[{id:0,invoice_id:0,product_code:s,quantity:t,unit_price:e,total_price:e*t}]}];return u.NextResponse.json({success:!0,data:a})}}return u.NextResponse.json({success:!0,data:[]})}let d=l.map(e=>e.id),_=[];if(d.length>0){let e=d.map((e,t)=>`$${t+1}`).join(","),t=`SELECT * FROM purchase_invoice_items WHERE invoice_id IN (${e}) ORDER BY invoice_id`;_=(await c.i6.query(t,d)).rows}let v=l.map(e=>({...e,items:_.filter(t=>t.invoice_id===e.id)}));if(s){let e=(0,p.rv)(s);v=v.filter(t=>t.items.some(t=>{let i=(0,p.rv)(t.product_code);return i===e||i.startsWith(e.split("-")[0]+"-")}))}let m=v.reduce((e,t)=>{let i=t.items.find(e=>{let t=(0,p.rv)(e.product_code),i=s?(0,p.rv)(s):"";return t===i||i&&t.startsWith(i.split("-")[0]+"-")});return e+(i?i.quantity:0)},0),x=o?parseInt(o):0;if(a&&s&&x>0){let e=parseFloat(a);if(!isNaN(e)&&e>0){if(0===v.length){let t=new Date().toISOString().split("T")[0];v=[{id:0,invoice_number:"MEVCUT FİYAT",supplier_id:i,invoice_date:t,total_amount:e*x,created_at:t,items:[{id:0,invoice_id:0,product_code:s,quantity:x,unit_price:e,total_price:e*x}]}],console.log("[API] Sanal fatura oluşturuldu (hi\xe7 fatura yok):",{productCode:s,unitPrice:e,quantity:x,total:e*x})}else if(m<x){let t=x-m,r=new Date().toISOString().split("T")[0];v.push({id:0,invoice_number:"MEVCUT FİYAT (Eksik Tamamlama)",supplier_id:i,invoice_date:r,total_amount:e*t,created_at:r,items:[{id:0,invoice_id:0,product_code:s,quantity:t,unit_price:e,total_price:e*t}]}),console.log("[API] Sanal fatura eklendi (eksik tamamlama):",{productCode:s,unitPrice:e,missingQuantity:t,totalAvailableQuantity:m,requiredQuantity:x,total:e*t})}}}return u.NextResponse.json({success:!0,data:v})}catch(e){return console.error("[api/suppliers/[id]/purchase-invoices] Hata:",e),u.NextResponse.json({success:!1,error:"Tedarik\xe7i satış faturaları alınamadı"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/suppliers/[id]/purchase-invoices/route",pathname:"/api/suppliers/[id]/purchase-invoices",filename:"route",bundlePath:"app/api/suppliers/[id]/purchase-invoices/route"},resolvedPagePath:"C:\\Users\\caner.karadag\\Cursor_Projeler\\Tedarikci_Irsaliye\\app\\app\\api\\suppliers\\[id]\\purchase-invoices\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:v,serverHooks:m}=d,x="/api/suppliers/[id]/purchase-invoices/route";function h(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:v})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[276,64,555],()=>i(9485));module.exports=r})();